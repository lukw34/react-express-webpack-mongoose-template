language: node_js
node_js:
  - "8.10"
sudo: required
install:
- npm install
cache:
  directories:
  - node_modules
jobs:
  include:
  - stage: eslint
    name: Code quality check
    script: npm run eslint
  - stage: tests
    name: Test client-side code
    script: npm run test:client
  - stage: tests
    name: Test server-side code
    script: npm run test:server
  - stage: build
    name: Build web app
    script: npm run build  
  - stage: GitHub Release
    script: bash docker_push.sh"
    if: tag = true
    deploy:
      provider: releases
      api_key: $GITHUB_OAUTH_TOKEN
      script: echo "Test Release............"
      skip_cleanup: true
      on:
        tags: true
  - stage: SCript Release
    script: echo "Test Script............"
    if: tag = true
    deploy:
      provider: script
      script: bash docker_push.sh"
      api_key: $GITHUB_OAUTH_TOKEN
      skip_cleanup: true
      on:
        tags: true
  - stage: SCript Release
    script: echo "Test Script............22"
    on:
      tags: true
    deploy:
      provider: script
      script: bash docker_push.sh"
      api_key: $GITHUB_OAUTH_TOKEN
      skip_cleanup: true
deploy:
  provider: script
  script: bash docker_push.sh"
  api_key: $GITHUB_OAUTH_TOKEN
  skip_cleanup: true
  on:
    tags: true